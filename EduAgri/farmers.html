<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farmers - EduAgri</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: "Poppins", sans-serif; background:#f9f9f9; color:#333; line-height:1.6; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity:1; transform: translateY(0); } }
    @keyframes slideDown { from { opacity:0; transform: translateY(-10px); } to { opacity:1; transform: translateY(0); } }

    header { background:#2d6a4f; color:white; padding:15px 40px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:100; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
    header h1 { margin:0; font-size:1.5rem; }
    nav { display:flex; align-items:center; gap:12px; }
    nav a { color:white; margin-left:8px; text-decoration:none; font-weight:500; transition: all 0.3s ease; }
    nav a:hover { color:#ffb703; transform:scale(1.05); }

    .dropdown { position:relative; }
    .dropdown-content { position:absolute; top:calc(100% + 6px); left:0; background:#fff; color:#333; min-width:200px; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.12); padding:8px 0; display:none; transform-origin:top center; animation: slideDown 0.18s ease both; }
    .dropdown-content a { display:block; padding:8px 14px; color:#333; text-decoration:none; }
    .dropdown-content a:hover { background:#f1f1f1; color:#ffb703; }
    .dropdown-content.show { display:block; }

    .hero { position: relative; text-align: center; color: white; padding:100px 20px; animation: fadeIn 0.7s ease; }
    .hero img { width: 100%; height: 300px; object-fit: cover; position: absolute; top:0; left:0; z-index:-1; opacity:0.95; }
    .hero h2 { font-size:2rem; margin-bottom:10px; position: relative; z-index:1; }
    section { padding:40px; text-align:center; }
    .card { background:white; padding:20px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.08); margin-bottom:20px; max-width:900px; margin-left:auto; margin-right:auto; text-align:left; animation:fadeIn 0.5s ease; transition: transform 0.28s ease, box-shadow 0.28s ease; }
    .card img { width:100%; border-radius:12px; margin-top:10px; }
    .card:hover { transform: translateY(-8px); box-shadow:0 14px 40px rgba(0,0,0,0.12); }

    .btn-secondary { background:#219ebc; color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; margin-top:10px; text-decoration:none; display:inline-block; transition: all 0.25s ease; }
    .btn-secondary:hover { background:#1b7b93; transform:translateY(-3px); box-shadow:0 8px 20px rgba(33,155,188,0.12); }

    footer { background:#2d6a4f; color:white; text-align:center; padding:30px 20px; margin-top:30px; animation:fadeIn 0.6s ease; }
    .form-row { display:flex; gap:15px; align-items:center; margin:8px 0; padding:10px; background:#fafafa; border-radius:6px; flex-wrap:wrap; }
    .form-row label { flex: 1; min-width: 180px; }
    .form-row span { white-space:nowrap; flex-shrink:0; }
    .form-row input[type="number"] { width:70px; padding:6px; border:1px solid #ddd; border-radius:4px; flex-shrink:0; }
    .form-row select { padding:6px 8px; border:1px solid #ddd; border-radius:4px; cursor:pointer; flex:1; min-width:180px; }
    .bid-card { background:#f9f9f9; padding:12px; border-radius:8px; margin-bottom:10px; border-left:4px solid #2d6a4f; }
    .bid-card h5 { color:#2d6a4f; margin:0 0 6px 0; font-size:1.05rem; }
    .bid-card p { margin:4px 0; font-size:0.9rem; color:#555; }
    .bid-card button { background:#ff7f50; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; margin-right:6px; font-size:0.85rem; transition:all 0.2s ease; }
    .bid-card button:hover { background:#ff6b3d; transform:translateY(-1px); }
    .bid-card button.danger { background:#c0392b; }
    .bid-card button.danger:hover { background:#a93226; }
    .order-item { background:#e6ffed; padding:10px; border-radius:6px; margin-bottom:8px; border-left:3px solid #27ae60; }
    .order-confirm { background:#e6ffed; border:1px solid #bdeac8; padding:12px; border-radius:8px; margin-top:12px; }
    .delete-btn { background:transparent; border:none; color:#c0392b; cursor:pointer; font-size:1rem; margin-left:8px; }
    #farmer-past-orders li { display:flex; justify-content:space-between; align-items:center; padding:6px 0; }
    /* Toast / non-blocking notification */
    .toast-container { position: fixed; right: 18px; bottom: 18px; display:flex; flex-direction:column; gap:10px; z-index:9999; }
    .toast { background: rgba(0,0,0,0.85); color: #fff; padding:10px 14px; border-radius:8px; min-width:200px; max-width:360px; box-shadow:0 8px 24px rgba(0,0,0,0.28); animation: slideDown 0.18s ease both; }
    .toast .title { font-weight:600; margin-bottom:4px; }
    .toast small { opacity:0.9; font-weight:400; }
  </style>
</head>
<body>

  <header>
    <h1>üåæ EduAgri</h1>
    <nav>
      <a href="index.html">Home</a>
      <div class="dropdown">
        <a href="javascript:void(0)" onclick="toggleDropdown(event)">Category ‚ñº</a>
        <div class="dropdown-content" id="courses-dropdown">
          <a href="soil.html">Soil Science</a>
          <a href="irrigation.html">Irrigation Techniques</a>
          <a href="crop.html">Crop Management</a>
          <a href="smart.html">Smart Farming</a>
          <a href="livestock.html">Livestock</a>
        </div>
      </div>
      <a href="community.html">Community</a>
      <a href="about.html">About</a>
      <a href="farmers.html">Farmers</a>
      <a href="customers.html">Customers</a>
      <a href="login.html">Login</a>
    </nav>
  </header>

  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <div class="hero" style="background: linear-gradient(rgba(45,106,79,0.7), rgba(45,106,79,0.7)), url('https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat;">
    <h2>Farmers' Market</h2>
    <p>Order essential inputs (seeds, fertilizers, tools) quickly ‚Äî designed for farmers.</p>
  </div>

  <section>
    <div class="card" id="role-check-message" style="display:none; background:#fff3cd; border-left:4px solid #ffc107;">
      <p style="color:#856404; font-weight:600;"></p>
    </div>

    <div id="farmer-content">
      <p>Bid on vegetables - Set your price per kg and available quantity.</p>

      <form id="create-bid-form">
        <div class="form-row">
          <label for="veg-select">Select Vegetable:</label>
          <select id="veg-select" required>
            <option value="">-- Choose --</option>
            <option value="v1">Tomato</option>
            <option value="v2">Potato</option>
            <option value="v3">Onion</option>
            <option value="v4">Carrot</option>
            <option value="v5">Broccoli</option>
          </select>
        </div>

        <div class="form-row">
          <label for="bid-price">Price per kg (‚Çπ):</label>
          <input type="number" id="bid-price" step="0.01" min="1" placeholder="e.g. 45" required>
        </div>

        <div class="form-row">
          <label for="bid-quantity">Available Quantity (kg):</label>
          <input type="number" id="bid-quantity" step="0.1" min="0.1" placeholder="e.g. 100" required>
        </div>

        <div style="margin-top:12px;">
          <button type="submit" class="btn-secondary">Create Bid</button>
        </div>
      </form>

      <div id="bid-result" aria-live="polite"></div>
    </div>

    <div class="card">
      <h3>My Active Bids üìä</h3>
      <div id="my-bids-container">Loading...</div>
    </div>

    <div class="card">
      <h3>Your Orders Received üì¶</h3>
      <p>Orders from customers who bought through your bids:</p>
      <div id="orders-received-container">Loading...</div>
    </div>
    </div>
  </section>

  <footer>
    <p>¬© 2025 EduAgri. All Rights Reserved.</p>
  </footer>

  <script>
    // Initialize vegetables list if not exists
    function initializeVegetables() {
      if (!localStorage.getItem('availableVegetables')) {
        const vegetables = [
          { id: 'v1', name: 'Tomato', unit: 'kg' },
          { id: 'v2', name: 'Potato', unit: 'kg' },
          { id: 'v3', name: 'Onion', unit: 'kg' },
          { id: 'v4', name: 'Carrot', unit: 'kg' },
          { id: 'v5', name: 'Broccoli', unit: 'kg' }
        ];
        localStorage.setItem('availableVegetables', JSON.stringify(vegetables));
      }
    }

    function getVegetableName(vegId) {
      const vegetables = JSON.parse(localStorage.getItem('availableVegetables')) || [];
      const veg = vegetables.find(v => v.id === vegId);
      return veg ? veg.name : 'Unknown';
    }

    // Create a new bid
    function createBid() {
      const form = document.getElementById('create-bid-form');
      const vegetableId = document.getElementById('veg-select').value;
      const pricePerKg = parseFloat(document.getElementById('bid-price').value);
      const quantity = parseFloat(document.getElementById('bid-quantity').value);

      const farmerId = localStorage.getItem('currentUser');
      if (!farmerId) {
        showToast('Please log in first!');
        return;
      }

      if (!vegetableId || pricePerKg <= 0 || quantity <= 0) {
        showToast('Please fill all fields with valid values');
        return;
      }

      const newBid = {
        bidId: 'bid_' + Date.now(),
        farmerId: farmerId,
        farmerName: farmerId,
        vegetableId: vegetableId,
        vegetableName: getVegetableName(vegetableId),
        pricePerKg: pricePerKg,
        quantity: quantity,
        quantityRemaining: quantity,
        bidCreatedAt: Date.now()
      };

      let bids = JSON.parse(localStorage.getItem('farmerBids')) || [];
      bids.push(newBid);
      localStorage.setItem('farmerBids', JSON.stringify(bids));

      showToast('Bid created successfully! ‚úÖ', 4500);
      form.reset();
      displayMyBids();
    }

    // Display farmer's active bids
    function displayMyBids() {
      const farmerId = localStorage.getItem('currentUser');
      const allBids = JSON.parse(localStorage.getItem('farmerBids')) || [];
      const myBids = allBids.filter(bid => bid.farmerId === farmerId);

      let html = '';
      
      if (myBids.length === 0) {
        html = '<p style="color:#999;">No active bids yet. Create one above!</p>';
      } else {
        myBids.forEach(bid => {
          const ordersCount = getOrdersCountForBid(bid.bidId);
          html += `
            <div class="bid-card">
              <h5>${bid.vegetableName} - ‚Çπ${bid.pricePerKg}/kg</h5>
              <p>Available: <strong>${bid.quantityRemaining}kg / ${bid.quantity}kg</strong></p>
              <p>Orders Received: <strong>${ordersCount}</strong></p>
              <button onclick="editBidPrice('${bid.bidId}')">Edit Price</button>
              <button class="danger" onclick="removeBid('${bid.bidId}')">Remove</button>
            </div>
          `;
        });
      }

      document.getElementById('my-bids-container').innerHTML = html;
    }

    // Edit bid price
    function editBidPrice(bidId) {
      const newPrice = prompt('Enter new price per kg (‚Çπ):');
      if (newPrice === null || parseFloat(newPrice) <= 0) return;

      let bids = JSON.parse(localStorage.getItem('farmerBids')) || [];
      const bid = bids.find(b => b.bidId === bidId);

      if (bid) {
        bid.pricePerKg = parseFloat(newPrice);
        localStorage.setItem('farmerBids', JSON.stringify(bids));
        showToast('Bid price updated! ‚úÖ', 4500);
        displayMyBids();
      }
    }

    // Remove bid
    function removeBid(bidId) {
      if (!confirm('Are you sure you want to remove this bid?')) return;

      let bids = JSON.parse(localStorage.getItem('farmerBids')) || [];
      bids = bids.filter(b => b.bidId !== bidId);
      localStorage.setItem('farmerBids', JSON.stringify(bids));
      showToast('Bid removed! ‚úÖ', 4500);
      displayMyBids();
    }

    // Get orders count for a bid
    function getOrdersCountForBid(bidId) {
      const orders = JSON.parse(localStorage.getItem('customerOrdersFromBids')) || [];
      return orders.filter(o => o.bidId === bidId).length;
    }

    // Display orders received by this farmer
    function displayOrdersReceived() {
      const farmerId = localStorage.getItem('currentUser');
      const allOrders = JSON.parse(localStorage.getItem('customerOrdersFromBids')) || [];
      const myOrders = allOrders.filter(o => o.farmerId === farmerId);

      let html = '';
      
      if (myOrders.length === 0) {
        html = '<p style="color:#999;">No orders received yet. Wait for customers to buy from your bids!</p>';
      } else {
        myOrders.forEach(order => {
          html += `
            <div class="order-item">
              <p><strong>Order ID:</strong> ${order.orderId.substr(-6)}</p>
              <p><strong>Customer:</strong> ${order.customerId}</p>
              <p><strong>Product:</strong> ${order.vegetableName}</p>
              <p><strong>Quantity:</strong> ${order.quantity}kg @ ‚Çπ${order.pricePerKg}/kg = <strong>‚Çπ${order.totalPrice}</strong></p>
              <p style="font-size:0.85rem; color:#666;">Ordered: ${new Date(order.bidId.split('_')[1]).toLocaleDateString()}</p>
            </div>
          `;
        });
      }

      document.getElementById('orders-received-container').innerHTML = html;
    }

    // Form submission
    document.getElementById('create-bid-form').addEventListener('submit', function(e) {
      e.preventDefault();
      createBid();
    });

    // Load on page load
    window.addEventListener('load', function() {
      const userRole = localStorage.getItem('userRole') || 'customer';
      const farmerContent = document.getElementById('farmer-content');
      const roleCheckMessage = document.getElementById('role-check-message');

      if (userRole !== 'farmer') {
        // User is not a farmer
        roleCheckMessage.style.display = 'block';
        roleCheckMessage.querySelector('p').textContent = '‚ö†Ô∏è This page is for farmers only. Please login with your farmer account to access bidding features.';
        farmerContent.style.display = 'none';
      } else {
        // User is a farmer
        roleCheckMessage.style.display = 'none';
        farmerContent.style.display = 'block';
        initializeVegetables();
        displayMyBids();
        displayOrdersReceived();
      }
    });
  </script>
    <script>
      // Non-blocking toast notifications to replace inline messages
      function showToast(message, duration) {
        duration = duration || 4500;
        var container = document.getElementById('toast-container');
        if (!container) return console.log(message);
        var t = document.createElement('div');
        t.className = 'toast';
        t.innerHTML = message.split('\n').map(function(line){ return '<div>' + line + '</div>'; }).join('');
        container.appendChild(t);
        setTimeout(function(){ t.style.opacity = '0'; t.style.transform = 'translateY(6px)'; }, duration - 300);
        setTimeout(function(){ try{ container.removeChild(t); }catch(e){} }, duration);
      }
    </script>
  <script>
    function toggleDropdown(event) {
      event.preventDefault();
      const dropdown = document.getElementById('courses-dropdown');
      dropdown.classList.toggle('show');
    }
    document.addEventListener('click', function(event) {
      const dropdown = document.querySelector('.dropdown');
      if (dropdown && !dropdown.contains(event.target)) {
        document.getElementById('courses-dropdown').classList.remove('show');
      }
    });
  </script>

</body>
</html>
